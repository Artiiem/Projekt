---
title: "projekt"
author: "Artur Kidaj, Kamil Kopiński"
date: "2023-10-12"
output:
  html_document: default
  pdf_document: default
editor_options:
  chunk_output_type: inline
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r echo=FALSE , warning=FALSE, include=FALSE}
library(openxlsx)
library(kableExtra)
library(knitr)
library(gt)
library(tidyverse)
library(PerformanceAnalytics)
library(gtsummary)
library(lmtest)
library(nortest)
library(ivreg)
```

## Wczytanie danych

```{r}
data <- read.csv("udemy_courses.csv")

data <- data[,-3]
data <- data[,-1]
```

W naszym projekcie skupimy się na analizie bazy danych "Udemy courses".

Oto pierwsze pięć wierszy z tabeli.

```{r}
gt(head(data,5))
```

## Zmienne

-   course_title - Tytuł kursu.

-   is_paid - Informuje o tym, czy dany kurs jest płatny.

-   price - Ukazuje cenę kursu wyrażoną w dolarach.

-   num_subscribers - Ukazuje liczbę subskrybentów kursu.

-   num_reviews - Ukazuje liczbę recenzji kursu.

-   num_lectures - Ukazuje liczbę wykładów kursu.

-   level - Przedstawia poziom trudności kursu podzielną na cztery kategorie:

    -   *Beginner Level* - poziom początkujący.

    -   *Intermediate Level* - poziom średniozaawansowany.

    -   *Expert Level* - poziom zaawansowany.

    -   *All levels* - wszystkie poziomy.

-   content_duration - Ukazuje długość kursu wyrażoną w godzinach.

-   published_timestamp - Przedstawia datę publikacji kursu o następującej strukturze:

    *rok-miesiąc-dzień T - godzina:minuta:sekunda Z*

-   subject - Przedstawia temat kursu wyrażonego w czterech różnych kategoriach:

    -   *Business Finance* - finanse? finanse przedsiębiorstw?

    -   *Graphic Design* -projekt graficzny.

    -   *Musical Instruments* - muzyczne instrumenty.

    -   *Web Development* - tworzenie/rozwój stron internetowych.

## Czyszczenie i przygotowanie danych

Czyszczenie danych

```{r}
data_clean <- data %>%
  filter(!is.na(price)) %>%
  mutate(price = as.numeric(price))
```

Sprawdzenie czy nie ma powtarzających się rekordów

```{r}
powtarzajace = data[duplicated(data),]
liczba = nrow(powtarzajace)
liczba
```

W pliku znalazło się 6 takich samych rekordów, więc je teraz usunę

```{r}
data_cleaned <- data %>% distinct()
```

## Analiza eksploracyjna

Podstawowe statystyki

```{r}
data %>% 
  select(-course_title,-published_timestamp) %>% 
  tbl_summary(
    type = all_continuous() ~ "continuous2",
    statistic = all_continuous() ~ c("{median} ({p25}, {p75})","{mean} {sd}", "{min}, {max}"))
```

Na podstawie podanych statystyk, możemy wywnioskować kilka rzeczy o kursach zawartych w zbiorze danych:

Różnorodność cen: Kursy na Udemy mają szeroki zakres cen, od darmowych (0 USD) do 200 USD. Średnia cena wynosi 66.05 USD, co wskazuje, że chociaż są kursy droższe, wiele z nich ma umiarkowaną cenę.

Popularność kursów: Liczba subskrybentów kursów jest bardzo zróżnicowana, z minimum 0 (co może oznaczać nowe kursy lub takie, które nie zyskały jeszcze popularności) do maksymalnej liczby subskrybentów wynoszącej 268,923. Mediana liczby subskrybentów wynosi 911,5, co oznacza, że połowa kursów ma mniej niż 912 subskrybentów, a połowa więcej. Średnia liczba subskrybentów jest znacznie wyższa (3197,2), co jest pociągnięte w górę przez kursy o wyjątkowo wysokiej liczbie subskrybentów.

Aktywność recenzentów: Liczba recenzji również się waha, z minimum 0 do maksimum 27,445. Średnia liczba recenzji wynosi 156,3, co wskazuje, że kursy są oceniane przez uczniów, ale istnieje znacząca różnica między najbardziej a najmniej ocenianymi kursami.

Zawartość kursu: Liczba wykładów waha się od 0 do 779, z medianą 25 i średnią 40,11. To sugeruje, że większość kursów ma dość ograniczoną liczbę wykładów, ale niektóre kursy oferują znacznie więcej materiału.

Poziom trudności: Poziom trudności kursów jest reprezentowany jako zmienna kategorialna, ale nie mamy tutaj danych dotyczących rozkładu tych kategorii.

Czas trwania treści: Czas trwania treści kursów ma szeroki zakres od 0 do 78,5 godzin, z medianą wynoszącą 2 godziny i średnią 4,095 godziny. To wskazuje, że większość kursów ma krótkie treści, ale są kursy, które są znacznie dłuższe.

Ogólnie, te statystyki wskazują na dużą różnorodność kursów dostępnych na Udemy, zarówno pod względem ceny, zawartości, jak i popularności. Możemy również wywnioskować, że kursy są w różnych przedziałach cenowych, co czyni je dostępnymi dla różnych grup demograficznych, a także pokazuje, że niektóre kursy są wyjątkowo popularne, co może wskazywać na wysoką jakość lub skuteczne marketingowe wsparcie.

## Wizualizacja danych

Wizualizacja rozkładu ceny kursów

```{r}
ggplot(data, aes(x = price)) + 
  geom_histogram(bins = 30, fill = "blue", color = "black") +
  theme_minimal() +
  labs(title = "Rozkład ceny kursów", x = "Cena", y = "Liczba kursów")
```

```{r}
data %>%
  group_by(subject) %>%
  summarise(count = n()) %>%
  ggplot(aes(x = reorder(subject, -count), y = count, fill = subject)) +
  geom_bar(stat = "identity") +
  theme_minimal() +
  labs(title = "Liczba kursów w każdej kategorii", x = "Kategoria", y = "Liczba kursów") +
  coord_flip()

```

Na podstawie tego wykresu można zaobserwować, że najwięcej kursów jest na temat biznesowy i informatyczny, prawdopodobnie dlatego, że według ludzi to właśnie w tych kierunkach trzeba się rozwijać aby dużo zarabiać, mniej jest kursów muzycznych, bo się mniej tam zarabia

```{r}
ggplot(data %>% filter(num_subscribers < 10000), aes(x = num_subscribers)) +
  geom_histogram(bins = 20, fill = "green", color = "black") +
  labs(title = "Histogram liczby subskrybentów (do 10000)", x = "Liczba subskrybentów", y = "Liczba kursów") +
  theme_minimal()
```

```{r}
ggplot(data %>% filter(num_reviews < 1000), aes(x = num_reviews)) +
  geom_histogram(bins = 20, fill = "orange", color = "black") +
  labs(title = "Histogram liczby recenzji (do 1000)", x = "Liczba recenzji", y = "Liczba kursów") +
  theme_minimal()
```

Na podstawie tych wykresów można stwierdzić, że zdecydowana większość kursów jest nie popularna, ponieważ ma liczbę recenzji oraz subskrybentów bliską zera

```{r}
ggplot(data, aes(x = level)) +
  geom_bar(fill = "purple") +
  labs(title = "Rozkład poziomu kursów", x = "Poziom", y = "Liczba kursów") +
  theme_minimal()
```

Najwięcej jest kursów dla wszystkich poziomów, następnie dla początkujących, wskazuje to, że większość osób porzuca naukę po początku nauki, albo że udemy jest stroną dla osób początkujących, a żeby czegoś więcej się nauczyć trzeba płacić więcej na innych stronach

Macierz korelacji

Zamiana danych jakościowych na ilościowe, aby móc je później przeanalizować
Level zmieniam na 
0 - All Levels
1 - Beginner Level
2 - Expert Level
3 - Intermediate Level

Subject zmieniam na
0 - Business Finance
1 - Graphic Design
2 - Musical Instruments
3 - Web Development
```{r}
data$is_paid <- ifelse(data$is_paid == "True", 1, 0)
data$level = as.integer(factor(data$level)) - 1
data$subject = as.integer(factor(data$subject)) - 1
```




```{r warning=FALSE}
Cor_mat = data[, c(2:8, 10)]
chart.Correlation(Cor_mat, histogram = TRUE)
```

## Kilka obserwacji z danej macierzy korelacji

Istnieje silna dodatnia korelacja między liczbą lekcji a całkowitym czasem trwania kursu. To wskazuje, że zwiększona liczba lekcji jest zazwyczaj skorelowana z dłuższym czasem dostępu do treści kursu, co jest zgodne z oczekiwaniami, że bogatsza w treści oferta edukacyjna wymaga więcej czasu na jej przyswojenie.

Analiza wykazała również istotną dodatnią korelację między liczbą recenzji a liczbą subskrybentów. Jest to wskaźnik, że kursy o większej liczbie zapisanych uczestników generują proporcjonalnie większą liczbę recenzji. To zjawisko może świadczyć o większym zaangażowaniu użytkowników w kursy, które cieszą się większą popularnością.

Z analizy wynika, że poziom trudności kursu, określony przez autora, nie wykazuje korelacji z żadną inną mierzoną zmienną w zestawie danych. Może to sugerować, że stopień trudności kursu jest determinowany niezależnie od innych czynników, takich jak czas trwania kursu, liczba lekcji, czy popularność kursu wśród subskrybentów.

Ponadto, obserwacja negatywnej korelacji między statusem płatności kursu a liczbą subskrybentów może wskazywać na tendencję, że kursy oferowane bezpłatnie przyciągają większą liczbę uczestników. To zjawisko może podkreślać wpływ dostępności cenowej na decyzje o zapisaniu się na kurs przez potencjalnych uczestników.


### Miary asymetrii i koncentracji

```{r}
base::sapply(list(price=data$price,num_subscribers=data$num_subscribers,
                  num_reviews=data$num_reviews,num_lectures=data$num_lectures,
                  content_duration=data$content_duration),
             simplify = TRUE,
             FUN =  function(x){
             c(skewness = skewness(x),
               kurtosis = kurtosis(x,method = 'moment'))}
) %>% 
  as.data.frame() %>% 
  gt(rownames_to_stub = TRUE)
```





## Modelowanie danych

```{r}
model_pusty <- lm(num_subscribers~-1,data = data_cleaned)
model_pelny <- lm(num_subscribers~price+num_reviews+num_lectures+content_duration, data=data_cleaned)
```

Selekcja w przód

```{r}
model1 <- step(model_pusty,scope = formula(model_pelny),direction = 'forward')
```

Eliminacja wsteczna

```{r}
model2 <- step(model_pelny,scope = formula(model_pelny),direction = 'backward')
```


```{r}
anova(model1,model2)
```

Na podstawie częściowego testu F dochodzimy do wniosku, że bardziej złożony model jest lepszy od prostszego modelu. Zatem dalszej analizie podamy model2.

## Obserwacje nietypowe

```{r}
plot(model2,which = 4:5)
```

Na podstawie wyżej ukazanych wykresów możemy stwierdzić, że w modelu znajdują się obserwacje nietypowe. Są to obserwacje numer 3199,3225 oraz 2822


```{r}
data_new <- data_cleaned[-3225,][-3199,][-2882,]
```

```{r}
model2 <- lm(num_subscribers~price+num_reviews+content_duration, data=data_new)
```

```{r}
summary(model2)
```


## Podstawowe założenia

Liniowość
```{r}
resettest(model2)
raintest(model2)
```

Homoskedastyczność
```{r}
bptest(model2)
```

Autokorelacja
```{r}
dwtest(model2)
```

Egzogeniczność
```{r}
```

Normalność reszt
```{r warning=FALSE}
lillie.test(model2$residuals)
shapiro.test(model2$residuals)
cvm.test(model2$residuals)
ad.test(model2$residuals)
```


Wszędzie wszystko odrzucamy.


```{r}
nowa_wart <- data.frame(price=min(data$price),num_reviews=min(data$num_reviews),content_duration=min(data$content_duration)) 
pred <- predict(model2,newdata=nowa_wart,interval='predict')
pred
```



## Wnioski
